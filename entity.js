"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.entity = exports.createBond = exports.Bond = exports.remove = exports.update = exports.insert = exports.select = exports.reactTo = exports.initFields = exports.fields = exports.field = exports.ftype = exports.fieldTypes = exports.bind = exports.$ = void 0;
const orray_1 = require("orray");
const isA = (value) => Array.isArray(value);
const isS = (value) => typeof value === 'string';
exports.$ = {
    limit: 50,
    id: () => "id"
};
function bind(ent, bond) {
    if (ent.listeners.includes(bond))
        console.warn("already binded");
    else
        ent.listeners.push(bond);
    return ent;
}
exports.bind = bind;
;
exports.fieldTypes = {};
const ftype = ({ tp }) => exports.fieldTypes[tp];
exports.ftype = ftype;
function field(ent, key) {
    let r = ent.fields.find(isS(key) ? (f) => f.key == key : key);
    return r;
}
exports.field = field;
function fields(ent, filter) {
    let field = filter ? ent.fields.filter(filter) : ent.fields;
    return field;
}
exports.fields = fields;
async function initFields(fields, tp) {
    for (let field of fields)
        await exports.fieldTypes[field.tp].init?.(field, tp);
    return fields;
}
exports.initFields = initFields;
function reactTo(ent, target) {
    (target.react ||= []).push(ent.key);
    return ent;
}
exports.reactTo = reactTo;
function select(ent, bond = {}) {
    if (!ent.get)
        console.error("this entity has not insert support");
    return exports.$.select(isS(ent) ? ent : ent.key, bond);
}
exports.select = select;
async function insert(ent, values) {
    if (!ent.post)
        console.error("this entity has not insert support");
    let result = await exports.$.insert(ent.key, values);
    await reload(ent);
    return result;
}
exports.insert = insert;
async function update(ent, values) {
    if (!ent.put)
        console.error("this entity has not update support");
    let result = await exports.$.update(ent.key, values);
    await reload(ent);
    return result;
}
exports.update = update;
async function remove(ent, ids) {
    if (!ent.delete)
        console.error("this entity has not delete support");
    let result = await exports.$.remove(ent.key, { id: ids });
    await reload(ent);
    return result;
}
exports.remove = remove;
function reload(ent, reloaded = []) {
    let l = ent.listeners.length, t1 = Array(l);
    for (let i = 0; i < l; i++)
        t1[i] = ent.listeners[i].select();
    reloaded.push(ent.key);
    ent.react?.forEach(async (key) => {
        if (!(key in entities))
            return;
        if (!reloaded.includes(key))
            reload(await entities[key], reloaded);
    });
    return Promise.all(t1);
}
const delay = 500;
class Bond {
    _query;
    _pag;
    _limit;
    _callindex;
    list;
    readOnly;
    length;
    fromStorage;
    toStorage;
    target;
    all;
    groupBy;
    sort;
    queryBy;
    fields;
    tags;
    where;
    constructor(e, opts = {}) {
        this.target = e;
        this.readOnly = opts.readOnly;
        this._limit = opts.limit == null ? exports.$.limit : opts.limit;
        this._pag = opts.pag || 1;
        let onupd = () => {
            this._pag = 1;
            this.select(delay);
        };
        this.groupBy = (0, orray_1.orray)(opts.groupBy);
        this.query = opts.query;
        this.sort = (0, orray_1.orray)(opts.sort, {
            parse: (e) => isS(e) ? { f: e } : e,
            key: 'f'
        }).onupdate(onupd);
        this.fields = (0, orray_1.orray)(opts.fields).onupdate(() => this.select(delay));
        this.tags = (0, orray_1.orray)(opts.tags).onupdate(onupd);
        this.queryBy = (0, orray_1.orray)(opts.queryBy || fields(e, f => f.query).map(f => f.key)).onupdate(onupd);
        this.where = isS(opts.where) ? [opts.where] : opts.where;
    }
    get key() { return this.target.key; }
    get tp() { return "full"; }
    get pags() {
        return this.limit ? Math.ceil(this.length / this.limit) : 1;
    }
    get query() {
        return this._query;
    }
    set query(value) {
        if (value != this._query) {
            this._pag = 1;
            this._query = value;
            this.select(delay);
        }
    }
    get pag() {
        return this._pag;
    }
    set pag(value) {
        if (value < 1)
            value = 1;
        else if (value > this.pags)
            value = this.pags;
        if (this._pag == value)
            return;
        this._pag = value;
        this.select();
    }
    get limit() {
        return this._limit;
    }
    set limit(value) {
        if (this._limit == value)
            return;
        this._pag = value ?
            Math.ceil(this._limit * this._pag / value) :
            1;
        this._limit = value;
        this.select();
    }
    ids() {
        if (this.pags > 1) {
            let t = this.toJSON();
            return exports.$.select(this.target.key, {
                tp: "col",
                fields: [exports.$.id(this.target)],
                where: t.where,
                query: t.query,
                queryBy: t.queryBy,
                groupBy: t.groupBy
            });
        }
        else
            return this.list.map(f => f.id);
    }
    pushFilter(value) {
        if (isA(this.where))
            this.where.push(value);
        else
            this.addFilter(Array
                .from({ length: 4 })
                .map(() => Math.round(Math.random() * 15).toString(16))
                .join(''), value);
        return this;
    }
    getFilter(key) {
        return isA(this.where) ? null : this.where?.[key] || null;
    }
    removeFilter(key) {
        let w = this.where;
        if (w && !isA(w))
            delete w[key];
        return this;
    }
    addFilter(key, value) {
        let w = this.where ||= {};
        if (isA(w)) {
            for (var r = {}, i = 0; i < w.length; i++)
                r[i] = w[i];
            w = r;
        }
        this.getFilter(key);
        w[key] = value;
        this.select(delay);
        return this;
    }
    whereV() {
        let w = this.where;
        return w ? isA(w) ? w.slice() : Object.values(w) : [];
    }
    bind(list) {
        if (!this.list) {
            (this.list = list || (0, orray_1.orray)()).key = 'id';
            bind(this.target, this);
            this.select();
        }
        return this.list;
    }
    _handlers;
    async getAll() {
        return await exports.$.select(this.target.key, Object.assign(this.toJSON(), {
            tp: undefined,
            limit: undefined,
            pag: undefined,
            total: undefined
        }));
    }
    select(wait) {
        let fn = async () => {
            let tags = {}, groups = {}, list = this.list;
            if (list) {
                let data = await exports.$.select(this.target.key, this);
                this.length = data.t;
                for (let key in list.tags)
                    if (list.tags[key])
                        tags[key] = list.tags[key].value.id;
                for (let key in list.g)
                    groups[key] = list.g[key].keyField();
                list.set(data.d);
                for (let key in tags)
                    (0, orray_1.setTag)(list, key, tags[key]);
                for (let key in groups) {
                    let group = groups[key];
                    list.g[key].set(list.filter(i => group.indexOf(i.id) != -1));
                }
                if (this._handlers)
                    for (let h of this._handlers)
                        h(data);
                return data;
            }
        };
        clearTimeout(this._callindex);
        if (wait) {
            this._callindex = setTimeout(fn, wait);
            return this;
        }
        else
            return fn();
    }
    on(handler) {
        this._handlers || (this._handlers = []).push(handler);
        return this;
    }
    toJSON() {
        let { query: q, queryBy: b, fields: f, where: w, sort: s, target: t } = this;
        return {
            tp: "full",
            fields: !f.length || t.fields.length == f.length ? undefined : f,
            where: w && (isA(w) ? w : Object.values(w)),
            limit: this.limit,
            pag: this.pag,
            query: q && b ? q : undefined,
            queryBy: q && b ? b : undefined,
            sort: s.length ? s : undefined,
        };
    }
}
exports.Bond = Bond;
const createBond = async (src) => new Bond(await entity(src), isS(src) ? void 0 : src);
exports.createBond = createBond;
const entities = {};
function entity(key, f, i) {
    isS(key) || (key = key.key);
    if (f) {
        (key in entities) && console.error("alread inserted");
        isA(f) ?
            (i ||= { get: true, post: true }).fields = f :
            i = f;
        i.listeners ||= [];
        i.key = key;
        return entities[key] = i;
    }
    if (key in entities)
        return entities[key];
    return (entities[key] = Promise.resolve(exports.$.create ? exports.$.create(key, i) : i)).then(v => entities[key] = v);
}
exports.entity = entity;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZW50aXR5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGlDQUFzQztBQUN0QyxNQUFNLEdBQUcsR0FBRyxDQUFDLEtBQVUsRUFBdUIsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDdEUsTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFVLEVBQW1CLEVBQUUsQ0FBQyxPQUFPLEtBQUssS0FBSyxRQUFRLENBQUM7QUE2RTFELFFBQUEsQ0FBQyxHQUFvQjtJQUNoQyxLQUFLLEVBQUUsRUFBRTtJQUNULEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJO0NBQ2YsQ0FBQztBQUNGLFNBQWdCLElBQUksQ0FBQyxHQUFXLEVBQUUsSUFBSTtJQUNwQyxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztRQUM5QixPQUFPLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7O1FBRS9CLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQU5ELG9CQU1DO0FBQUEsQ0FBQztBQUVXLFFBQUEsVUFBVSxHQUFHLEVBQUUsQ0FBQztBQUN0QixNQUFNLEtBQUssR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLGtCQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7QUFBbkMsUUFBQSxLQUFLLFNBQThCO0FBQ2hELFNBQWdCLEtBQUssQ0FBQyxHQUFXLEVBQUUsR0FBaUM7SUFDbEUsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMs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